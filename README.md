# mapgen

[![Go](https://img.shields.io/badge/go-1.24+-blue)](https://go.dev/)
[![License](https://img.shields.io/github/license/nduyhai/mapgen)](LICENSE)

A code generation tool for Go that automatically generates type-safe mapper implementations based on interface definitions and annotations.

## Features

- **Interface-Driven Development**: Define your mapping requirements as Go interfaces with annotations
- **Type-Safe Mapping**: Generate type-safe code for mapping between different data structures
- **Custom Mapping Functions**: Use custom functions for complex mapping scenarios
- **Field Mapping Control**: Explicitly map fields or ignore specific fields
- **Clean Generated Code**: Generated code is readable and maintainable

## Getting Started

### Installation

```shell
go install github.com/nduyhai/mapgen/cmd/mapgen@latest
```

### Running mapgen

```shell
# Run in the current directory
mapgen

# Or using go run
go run cmd/mapgen/*.go
```

## Annotation Rules

Mapgen uses Go comments with special annotations to define mapping behavior. All annotations start with `+mapgen:` followed by the directive type and parameters.

### Mapper Interface Annotation

The mapper interface annotation defines a mapper interface and its implementation details.

```go
// +mapgen:mapper impl:<implementation_name> [target:<target_file>]
type MyMapper interface {
    // Method definitions with mapping annotations
}
```

Parameters:
- `impl`: (Required) The name of the generated implementation struct
- `target`: (Optional) The target file for the generated code. If not specified, the code will be generated in a file with the same name as the source file but with "_mapper" appended.

### Mapping Annotations

Mapping annotations define how fields are mapped between source and target types. They are placed as comments above the method they apply to.

```go
// +mapgen:mapping from:<source_field> to:<target_field> [using:<function>]
// +mapgen:mapping ignore:<field>
// +mapgen:mapping to:<target_field> using:<function>
```

Parameters:
- `from`: The field name in the source type
- `to`: The field name in the target type
- `using`: (Optional) A function to use for the mapping
- `ignore`: A field to ignore during mapping

### Default Mapping Behavior

If no mapping annotations are provided for a method, mapgen will automatically map all fields with matching names from the source to the target. This is done using direct field assignments:

1. For each field in the target type, a direct assignment is generated from the corresponding field in the source type
2. Fields with matching names and compatible types are directly copied from source to target
3. Fields with different names or incompatible types are not mapped

This default behavior makes it easy to map simple DTOs without having to specify each field mapping explicitly.

## Examples

### Basic Mapper

```go
// +mapgen:mapper impl:userMapper
type UserMapper interface {
    // +mapgen:mapping from:UserName to:Name
    // +mapgen:mapping from:Email to:Email
    // +mapgen:mapping from:CreatedAt to:CreatedAt
    ToDTO(*User) *UserDTO
}
```

### Advanced Mapping with Custom Functions

```go
// +mapgen:mapper impl:userMapper target:user_mapper.go
type UserMapper interface {
    // +mapgen:mapping from:UserName to:Name
    // +mapgen:mapping from:CreatedAt to:CreatedAt using:TimeToUnix
    // +mapgen:mapping ignore:PasswordHash
    // +mapgen:mapping to:RetrievedAt using:GetCurrentTime
    ToDTO(*User) *UserDTO
}
```

### Generated Implementation

The generated code will look something like this:

```go
// Code generated by mapgen; DO NOT EDIT.

package mypackage

import (
    "github.com/example/dto"
)

// userMapper is a generated mapper implementation.
type userMapper struct{}

// ToDTO maps from *User to *UserDTO.
func (m *userMapper) ToDTO(source *User) *UserDTO {
    target := &UserDTO{}

    // Apply field mappings
    target.Name = source.UserName
    target.Email = source.Email
    target.CreatedAt = TimeToUnix(source.CreatedAt)
    target.RetrievedAt = GetCurrentTime()
    // PasswordHash is ignored

    return target
}
```

## Annotation Reference

### Mapper Directives

| Directive | Description | Example |
|-----------|-------------|---------|
| `+mapgen:mapper` | Defines a mapper interface | `// +mapgen:mapper impl:userMapper` |

### Mapping Directives

| Directive | Description | Example |
|-----------|-------------|---------|
| `+mapgen:mapping from:X to:Y` | Maps field X from source to field Y in target | `// +mapgen:mapping from:UserName to:Name` |
| `+mapgen:mapping from:X to:Y using:Z` | Maps field X to Y using function Z | `// +mapgen:mapping from:CreatedAt to:CreatedAt using:TimeToUnix` |
| `+mapgen:mapping ignore:X` | Ignores field X during mapping | `// +mapgen:mapping ignore:PasswordHash` |
| `+mapgen:mapping to:X using:Y` | Sets field X in target using function Y | `// +mapgen:mapping to:RetrievedAt using:GetCurrentTime` |